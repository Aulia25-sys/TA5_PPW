<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator Lengkap</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root {
            --warna-utama: #20b2aa;
            --warna-tosca-muda: #e0f2f1;
            --warna-tosca-tua: #00897b;
        }
        
        * {
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }
        
        .pembungkus-kalkulator {
            display: flex;
            gap: 20px;
            width: 100%;
            height: calc(100vh - 40px);
            max-width: 100%;
        }
        
        @media (max-width: 768px) {
            .pembungkus-kalkulator {
                flex-direction: column;
                height: auto;
            }
            
            .sidebar-riwayat {
                display: none;
            }
        }
        
        .kontainer-kalkulator {
            flex: 1;
            max-width: 400px;
            background-color: white;
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .kalkulator {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            width: 100%;
        }
        
        .kontainer-tampilan {
            background: #2c3e50;
            color: white;
            padding: 15px;
            text-align: right;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            border-radius: 8px;
            margin-bottom: 8px;
        }
        
        .tampilan-riwayat {
            font-size: 14px;
            color: #bdc3c7;
            min-height: 18px;
            margin-bottom: 8px;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .tampilan-utama {
            font-size: 32px;
            font-weight: 300;
            word-break: break-all;
            overflow-wrap: break-word;
        }
        
        .kursor {
            display: inline-block;
            width: 2px;
            height: 35px;
            background-color: var(--warna-utama);
            animation: kedip 1s infinite;
            margin-left: 2px;
            vertical-align: middle;
        }
        
        @keyframes kedip {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }
        
        .badan-kalkulator {
            padding: 0;
        }
        
        .baris-tombol {
            margin-bottom: 6px;
        }
        
        .tombol-kalkulator {
            height: 52px;
            font-size: 16px;
            font-weight: 500;
            border-radius: 8px;
            border: none;
            transition: all 0.2s;
        }
        
        .tombol-kalkulator:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .tombol-kalkulator:active {
            transform: translateY(0);
        }
        
        .tombol-angka {
            background-color: #ffffff;
            color: #2c3e50;
            border: 1px solid #e0e0e0;
        }
        
        .tombol-angka:hover {
            background-color: #f5f5f5;
        }
        
        .tombol-operator {
            background-color: var(--warna-utama);
            color: white;
        }
        
        .tombol-operator:hover {
            background-color: var(--warna-tosca-tua);
        }
        
        .tombol-sama-dengan {
            background-color: var(--warna-utama);
            color: white;
        }
        
        .tombol-sama-dengan:hover {
            background-color: var(--warna-tosca-tua);
        }
        
        .tombol-hapus {
            background-color: #f8f9fa;
            color: #e74c3c;
            border: 1px solid #e0e0e0;
        }
        
        .tombol-hapus:hover {
            background-color: #ffeaea;
        }
        
        .tombol-memori {
            background-color: var(--warna-tosca-muda);
            color: var(--warna-tosca-tua);
            border: 1px solid #b2dfdb;
            height: 42px;
            font-size: 13px;
        }
        
        .tombol-memori:hover {
            background-color: #b2dfdb;
        }
        
        .tombol-panah {
            background-color: var(--warna-tosca-muda);
            color: var(--warna-tosca-tua);
            border: 1px solid #b2dfdb;
            height: 28px;
            width: 28px;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            border-radius: 5px;
        }
        
        .tombol-panah:hover {
            background-color: #b2dfdb;
        }
        
        .segitiga-atas {
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-bottom: 9px solid var(--warna-tosca-tua);
        }
        
        .segitiga-bawah {
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-top: 9px solid var(--warna-tosca-tua);
        }
        
        .segitiga-kiri {
            width: 0;
            height: 0;
            border-top: 6px solid transparent;
            border-bottom: 6px solid transparent;
            border-right: 9px solid var(--warna-tosca-tua);
        }
        
        .segitiga-kanan {
            width: 0;
            height: 0;
            border-top: 6px solid transparent;
            border-bottom: 6px solid transparent;
            border-left: 9px solid var(--warna-tosca-tua);
        }
        
        .sidebar-riwayat {
            flex: 2;
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            max-height: 100%;
        }
        
        .judul-riwayat {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--warna-tosca-tua);
            padding-bottom: 10px;
            border-bottom: 2px solid var(--warna-tosca-muda);
        }
        
        .daftar-riwayat {
            flex: 1;
            overflow-y: auto;
        }
        
        .item-riwayat {
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
            font-size: 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .item-riwayat:last-child {
            border-bottom: none;
        }
        
        .tombol-hapus-riwayat {
            background: none;
            border: none;
            color: #e74c3c;
            font-size: 14px;
            cursor: pointer;
            padding: 3px 6px;
            border-radius: 3px;
            transition: all 0.2s;
        }
        
        .tombol-hapus-riwayat:hover {
            background: #ffeaea;
        }
        
        .indikator-memori {
            font-size: 12px;
            color: var(--warna-utama);
            margin-top: 5px;
        }
        
        .panel-panah {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding: 8px 0;
        }
        
        .grid-panah {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 2px;
            width: 70px;
            height: 70px;
        }
        
        .panah-atas {
            grid-column: 2;
            grid-row: 1;
        }
        
        .panah-kiri {
            grid-column: 1;
            grid-row: 2;
        }
        
        .panah-tengah {
            grid-column: 2;
            grid-row: 2;
            background: transparent;
            border: none;
            box-shadow: none;
            cursor: default;
        }
        
        .panah-kanan {
            grid-column: 3;
            grid-row: 2;
        }
        
        .panah-bawah {
            grid-column: 2;
            grid-row: 3;
        }
        
        .kolom-memori {
            display: flex;
            flex-direction: column;
            gap: 6px;
            width: 70px;
        }
    </style>
</head>
<body>
    <div class="pembungkus-kalkulator">
        <div class="kontainer-kalkulator">
            <div class="kalkulator">
                <div class="kontainer-tampilan">
                    <div class="tampilan-riwayat" id="tampilanRiwayat"></div>
                    <div class="tampilan-utama" id="tampilanUtama">0</div>
                    <div class="indikator-memori" id="indikatorMemori"></div>
                </div>
                
                <div class="badan-kalkulator">
                    <!-- Panel Panah dan Memori -->
                    <div class="panel-panah">
                        <div class="kolom-memori">
                            <button class="btn tombol-kalkulator tombol-memori w-100" data-aksi="m-plus">M+</button>
                            <button class="btn tombol-kalkulator tombol-memori w-100" data-aksi="mr">MR</button>
                        </div>
                        
                        <div class="grid-panah">
                            <button class="btn tombol-kalkulator tombol-panah panah-atas" data-aksi="panah-atas">
                                <div class="segitiga-atas"></div>
                            </button>
                            <button class="btn tombol-kalkulator tombol-panah panah-kiri" data-aksi="panah-kiri">
                                <div class="segitiga-kiri"></div>
                            </button>
                            <div class="panah-tengah"></div>
                            <button class="btn tombol-kalkulator tombol-panah panah-kanan" data-aksi="panah-kanan">
                                <div class="segitiga-kanan"></div>
                            </button>
                            <button class="btn tombol-kalkulator tombol-panah panah-bawah" data-aksi="panah-bawah">
                                <div class="segitiga-bawah"></div>
                            </button>
                        </div>
                        
                        <div class="kolom-memori">
                            <button class="btn tombol-kalkulator tombol-memori w-100" data-aksi="m-minus">M-</button>
                            <button class="btn tombol-kalkulator tombol-memori w-100" data-aksi="mc">MC</button>
                        </div>
                    </div>
                    
                    <div class="row baris-tombol">
                        <div class="col-3">
                            <button class="btn tombol-kalkulator tombol-hapus w-100" data-aksi="hapus-semua">C</button>
                        </div>
                        <div class="col-3">
                            <button class="btn tombol-kalkulator tombol-hapus w-100" data-aksi="hapus-masukan">CE</button>
                        </div>
                        <div class="col-3">
                            <button class="btn tombol-kalkulator tombol-operator w-100" data-aksi="bagi">÷</button>
                        </div>
                        <div class="col-3">
                            <button class="btn tombol-kalkulator tombol-operator w-100" data-aksi="kali">×</button>
                        </div>
                    </div>
                    
                    <div class="row baris-tombol">
                        <div class="col-3">
                            <button class="btn tombol-kalkulator tombol-angka w-100" data-angka="7">7</button>
                        </div>
                        <div class="col-3">
                            <button class="btn tombol-kalkulator tombol-angka w-100" data-angka="8">8</button>
                        </div>
                        <div class="col-3">
                            <button class="btn tombol-kalkulator tombol-angka w-100" data-angka="9">9</button>
                        </div>
                        <div class="col-3">
                            <button class="btn tombol-kalkulator tombol-operator w-100" data-aksi="kurang">-</button>
                        </div>
                    </div>
                    
                    <div class="row baris-tombol">
                        <div class="col-3">
                            <button class="btn tombol-kalkulator tombol-angka w-100" data-angka="4">4</button>
                        </div>
                        <div class="col-3">
                            <button class="btn tombol-kalkulator tombol-angka w-100" data-angka="5">5</button>
                        </div>
                        <div class="col-3">
                            <button class="btn tombol-kalkulator tombol-angka w-100" data-angka="6">6</button>
                        </div>
                        <div class="col-3">
                            <button class="btn tombol-kalkulator tombol-operator w-100" data-aksi="tambah">+</button>
                        </div>
                    </div>
                    
                    <div class="row baris-tombol">
                        <div class="col-3">
                            <button class="btn tombol-kalkulator tombol-angka w-100" data-angka="1">1</button>
                        </div>
                        <div class="col-3">
                            <button class="btn tombol-kalkulator tombol-angka w-100" data-angka="2">2</button>
                        </div>
                        <div class="col-3">
                            <button class="btn tombol-kalkulator tombol-angka w-100" data-angka="3">3</button>
                        </div>
                        <div class="col-3">
                            <button class="btn tombol-kalkulator tombol-sama-dengan w-100" data-aksi="sama-dengan">=</button>
                        </div>
                    </div>
                    
                    <div class="row baris-tombol">
                        <div class="col-6">
                            <button class="btn tombol-kalkulator tombol-angka w-100" data-angka="0">0</button>
                        </div>
                        <div class="col-3">
                            <button class="btn tombol-kalkulator tombol-angka w-100" data-aksi="desimal">.</button>
                        </div>
                        <div class="col-3">
                            <button class="btn tombol-kalkulator tombol-hapus w-100" data-aksi="hapus">⌫</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="sidebar-riwayat">
            <div class="judul-riwayat">Riwayat Perhitungan</div>
            <div class="daftar-riwayat" id="daftarRiwayat"></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Status kalkulator
            let ekspresi = '';
            let masukanSaatIni = '0';
            let nilaiMemori = 0;
            let riwayatPerhitungan = [];
            let posisiKursor = 0;
            let indeksRiwayat = -1;
            let waktuTekanSamaDenganTerakhir = 0;
            let harusResetMasukan = false;
            
            // Elemen DOM
            const tampilanUtama = document.getElementById('tampilanUtama');
            const tampilanRiwayat = document.getElementById('tampilanRiwayat');
            const daftarRiwayat = document.getElementById('daftarRiwayat');
            const indikatorMemori = document.getElementById('indikatorMemori');
            
            // Fungsi perbarui tampilan
            function perbaruiTampilan() {
                let nilaiTampilan = ekspresi;
                if (posisiKursor < nilaiTampilan.length) {
                    nilaiTampilan = nilaiTampilan.slice(0, posisiKursor) + 
                                  '<span class="kursor"></span>' + 
                                  nilaiTampilan.slice(posisiKursor);
                } else {
                    nilaiTampilan += '<span class="kursor"></span>';
                }
                
                tampilanUtama.innerHTML = nilaiTampilan || '0';
                
                // Perbarui indikator memori
                if (nilaiMemori !== 0) {
                    indikatorMemori.textContent = `M: ${nilaiMemori}`;
                } else {
                    indikatorMemori.textContent = '';
                }
                
                perbaruiTampilanRiwayat();
            }
            
            // Fungsi untuk menambahkan angka
            function masukkanAngka(angka) {
                if (masukanSaatIni === '0' || harusResetMasukan) {
                    masukanSaatIni = angka;
                    harusResetMasukan = false;
                } else {
                    masukanSaatIni += angka;
                }
                
                if (ekspresi === '' || harusResetMasukan) {
                    ekspresi = angka;
                } else {
                    ekspresi += angka;
                }
                
                posisiKursor = ekspresi.length;
                perbaruiTampilan();
            }
            
            // Fungsi untuk menambahkan titik desimal
            function masukkanDesimal() {
                if (harusResetMasukan) {
                    masukanSaatIni = '0.';
                    harusResetMasukan = false;
                    ekspresi = '0.';
                } else if (!masukanSaatIni.includes('.')) {
                    masukanSaatIni += '.';
                    ekspresi += '.';
                }
                posisiKursor = ekspresi.length;
                perbaruiTampilan();
            }
            
            // Fungsi untuk menghapus masukan saat ini (CE)
            function hapusMasukan() {
                masukanSaatIni = '0';
                ekspresi = '';
                posisiKursor = 0;
                perbaruiTampilan();
            }
            
            // Fungsi untuk menghapus semua (C)
            function hapusSemua() {
                masukanSaatIni = '0';
                ekspresi = '';
                posisiKursor = 0;
                indeksRiwayat = -1;
                perbaruiTampilan();
            }
            
            // Fungsi untuk menghapus karakter di posisi kursor (⌫)
            function hapusDiKursor() {
                if (ekspresi.length > 0 && posisiKursor > 0) {
                    ekspresi = ekspresi.slice(0, posisiKursor - 1) + ekspresi.slice(posisiKursor);
                    posisiKursor--;
                    
                    // Perbarui masukanSaatIni
                    const bagian = ekspresi.split(/[\+\-\×\÷]/);
                    masukanSaatIni = bagian[bagian.length - 1] || '0';
                } else {
                    masukanSaatIni = '0';
                }
                perbaruiTampilan();
            }
            
            // Fungsi  operator
            function tanganiOperator(operatorBerikutnya) {
                const operator = {
                    'tambah': '+',
                    'kurang': '-', 
                    'kali': '×',
                    'bagi': '÷'
                };
                
                // Perbarui ekspresi dengan operator
                ekspresi += ' ' + operator[operatorBerikutnya] + ' ';
                posisiKursor = ekspresi.length;
                
                // Reset masukan untuk angka berikutnya
                masukanSaatIni = '0';
                harusResetMasukan = true;
                
                perbaruiTampilan();
            }
            
            // Fungsi eksekusi perhitungan
            function lakukanPerhitungan() {
                const sekarang = Date.now();
                
                // Cek jika sama dengan ditekan dua kali berturut-turut (dalam 500ms)
                if (sekarang - waktuTekanSamaDenganTerakhir < 500) {
                    hapusSemua();
                    waktuTekanSamaDenganTerakhir = 0;
                    return;
                }
                
                waktuTekanSamaDenganTerakhir = sekarang;
                
                if (ekspresi === '') return;
                
                try {
                    // Ganti simbol untuk evaluasi
                    let ekspresiEvaluasi = ekspresi.replace(/×/g, '*').replace(/÷/g, '/');
                    let hasil = eval(ekspresiEvaluasi);
    
                    tambahkanKeRiwayat(`${ekspresi} = ${hasil}`);
                
                    masukanSaatIni = hasil.toString();
                    ekspresi = masukanSaatIni;
                    posisiKursor = ekspresi.length;
                } catch (e) {
                    masukanSaatIni = 'Error';
                    ekspresi = '';
                    posisiKursor = 0;
                }
                
                perbaruiTampilan();
            }
            
            // Fungsi menambahkan ke riwayat
            function tambahkanKeRiwayat(perhitungan) {
                riwayatPerhitungan.unshift(perhitungan);
               
                if (riwayatPerhitungan.length > 25) {
                    riwayatPerhitungan.pop();
                }
                perbaruiTampilanRiwayat();
            }
            
            // Fungsi menghapus item riwayat tertentu
            function hapusItemRiwayat(indeks) {
                riwayatPerhitungan.splice(indeks, 1);
                perbaruiTampilanRiwayat();
            }
            
            // Fungsi kursor dengan tombol panah
            function gerakkanKursor(arah) {
                if (ekspresi === '') return;
                
                if (arah === 'kiri' && posisiKursor > 0) {
                    posisiKursor--;
                } else if (arah === 'kanan' && posisiKursor < ekspresi.length) {
                    posisiKursor++;
                }
                perbaruiTampilan();
            }
            
            // Fungsi untuk tombol panah atas/bawah
            function navigasiRiwayat(arah) {
                if (riwayatPerhitungan.length === 0) return;
                
                if (arah === 'atas') {
                    if (indeksRiwayat < riwayatPerhitungan.length - 1) {
                        indeksRiwayat++;
                    } else {
                        indeksRiwayat = 0;
                    }
                } else if (arah === 'bawah') {
                    if (indeksRiwayat > 0) {
                        indeksRiwayat--;
                    } else {
                        indeksRiwayat = riwayatPerhitungan.length - 1;
                    }
                }
                
                
                if (indeksRiwayat >= 0 && indeksRiwayat < riwayatPerhitungan.length) {
                    const itemRiwayat = riwayatPerhitungan[indeksRiwayat];
                    const bagian = itemRiwayat.split(' = ');
                    if (bagian.length === 2) {
                        const hasil = bagian[1];
                        
                        ekspresi += hasil;
                        masukanSaatIni = hasil;
                        posisiKursor = ekspresi.length;
                        perbaruiTampilan();
                    }
                }
            }
            
            // Fungsi untuk memperbarui tampilan riwayat
            function perbaruiTampilanRiwayat() {
                daftarRiwayat.innerHTML = '';
                
                if (riwayatPerhitungan.length === 0) {
                    daftarRiwayat.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">Tidak ada riwayat</div>';
                    return;
                }
                
                riwayatPerhitungan.forEach((item, indeks) => {
                    const itemRiwayat = document.createElement('div');
                    itemRiwayat.className = 'item-riwayat';
                    
                    const divKonten = document.createElement('div');
                    divKonten.textContent = item;
                    
                    const tombolHapus = document.createElement('button');
                    tombolHapus.className = 'tombol-hapus-riwayat';
                    tombolHapus.textContent = '✕';
                    tombolHapus.addEventListener('click', () => hapusItemRiwayat(indeks));
                    
                    itemRiwayat.appendChild(divKonten);
                    itemRiwayat.appendChild(tombolHapus);
                    daftarRiwayat.appendChild(itemRiwayat);
                });
            }
            
            // Fungsi untuk menangani tombol memori
            function tanganiMemori(aksi) {
                const nilaiSaatIni = parseFloat(masukanSaatIni);
                
                switch(aksi) {
                    case 'm-plus':
                        nilaiMemori += nilaiSaatIni;
                        break;
                    case 'm-minus':
                        nilaiMemori -= nilaiSaatIni;
                        break;
                    case 'mr':
                        masukanSaatIni = nilaiMemori.toString();
                        ekspresi = masukanSaatIni;
                        posisiKursor = ekspresi.length;
                        harusResetMasukan = true;
                        break;
                    case 'mc':
                        nilaiMemori = 0;
                        break;
                }
                
                perbaruiTampilan();
            }
            
            // Event listener untuk tombol angka
            document.querySelectorAll('[data-angka]').forEach(tombol => {
                tombol.addEventListener('click', () => {
                    if (masukanSaatIni === 'Error') {
                        hapusSemua();
                    }
                    masukkanAngka(tombol.getAttribute('data-angka'));
                });
            });
            
            // Event listener untuk tombol operator
            document.querySelectorAll('[data-aksi]').forEach(tombol => {
                tombol.addEventListener('click', () => {
                    const aksi = tombol.getAttribute('data-aksi');
                    
                    if (masukanSaatIni === 'Error' && aksi !== 'hapus-semua' && aksi !== 'hapus-masukan' && aksi !== 'hapus') {
                        return;
                    }
                    
                    switch(aksi) {
                        case 'hapus-semua':
                            hapusSemua();
                            break;
                        case 'hapus-masukan':
                            hapusMasukan();
                            break;
                        case 'hapus':
                            hapusDiKursor();
                            break;
                        case 'desimal':
                            masukkanDesimal();
                            break;
                        case 'sama-dengan':
                            lakukanPerhitungan();
                            break;
                        case 'tambah':
                        case 'kurang':
                        case 'kali':
                        case 'bagi':
                            tanganiOperator(aksi);
                            break;
                        case 'mc':
                        case 'mr':
                        case 'm-plus':
                        case 'm-minus':
                            tanganiMemori(aksi);
                            break;
                        case 'panah-kiri':
                            gerakkanKursor('kiri');
                            break;
                        case 'panah-kanan':
                            gerakkanKursor('kanan');
                            break;
                        case 'panah-atas':
                            navigasiRiwayat('atas');
                            break;
                        case 'panah-bawah':
                            navigasiRiwayat('bawah');
                            break;
                    }
                });
            });
            
            // Dukungan keyboard
            document.addEventListener('keydown', function(event) {
                if (event.key >= '0' && event.key <= '9') {
                    if (masukanSaatIni === 'Error') {
                        hapusSemua();
                    }
                    masukkanAngka(event.key);
                } else if (event.key === '.') {
                    masukkanDesimal();
                } else if (event.key === '+' || event.key === '-') {
                    tanganiOperator(event.key === '+' ? 'tambah' : 'kurang');
                } else if (event.key === '*' || event.key === 'x') {
                    tanganiOperator('kali');
                } else if (event.key === '/') {
                    tanganiOperator('bagi');
                } else if (event.key === 'Enter' || event.key === '=') {
                    lakukanPerhitungan();
                } else if (event.key === 'Escape' || event.key === 'c' || event.key === 'C') {
                    hapusSemua();
                } else if (event.key === 'Backspace') {
                    hapusDiKursor();
                } else if (event.key === 'ArrowLeft') {
                    gerakkanKursor('kiri');
                } else if (event.key === 'ArrowRight') {
                    gerakkanKursor('kanan');
                } else if (event.key === 'ArrowUp') {
                    navigasiRiwayat('atas');
                } else if (event.key === 'ArrowDown') {
                    navigasiRiwayat('bawah');
                }
            });
            
            // Inisialisasi tampilan
            perbaruiTampilan();
        });
    </script>
</body>
</html>